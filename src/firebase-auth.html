<dom-module id="firebase-auth">
  <script>
    class FirebaseAuth extends Polymer.GestureEventListeners(Polymer.Element) {

      static get is() {
        return "firebase-auth";
      }

      static get properties() {
        return {
          user: {
            type: Object,
            notify: true,
          },
          provider: Object,
        };
      }

      connectedCallback() {
        super.connectedCallback();

        firebase.auth().onAuthStateChanged(this._userChange.bind(this));
        this.set("provider", new firebase.auth.GoogleAuthProvider());
      }

      signIn() {
        firebase.auth().signInWithPopup(this.provider)
          .catch( err => { 
            throw new Error(err);
          });
      }

      signOut() {
        firebase.auth().signOut()
          .catch( err => { 
            throw new Error(err);
          });
      }

      _userChange(user) {
        this.set("user", user);
        this.fire("user-changed", user);
      }

      fire(name, detail){
        this.dispatchEvent(new CustomEvent(name, {composed: true, bubbles: true, detail: detail}));
      }
    }
    customElements.define(FirebaseAuth.is, FirebaseAuth);
  </script>
</dom-module>