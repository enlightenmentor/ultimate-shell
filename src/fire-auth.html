<dom-module id="fire-auth">
  <script>
    class FireAuth extends Polymer.Element {

      static get is() {
        return "fire-auth";
      }

      static get properties() {
        return {
          user: {
            type: Object,
            notify: true,
          },
          provider: {
            type: Object,
            value: () => {
              const provider = new firebase.auth.GoogleAuthProvider();
              provider.addScope('https://www.googleapis.com/auth/contacts.readonly'); // OAuth 2.0
              return provider;
            }
          },
        };
      }

      checkUser() {
        return new Promise((resolve, reject) => {
          firebase.auth().onAuthStateChanged((user) => {
            return resolve(user);
          });
        });
      }

      signIn() {
        return firebase.auth().signInWithPopup(this.provider);
      }

      signOut() {
        return firebase.auth().signOut();
      }

      fire(name, detail) {
        this.dispatchEvent(new CustomEvent(name, {
          composed: true,
          bubbles: true,
          detail: detail
        }));
      }
    }
    customElements.define(FireAuth.is, FireAuth);
  </script>
</dom-module>